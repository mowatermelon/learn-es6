<!DOCTYPE html><html><head><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta charset="utf-8"><title>通过Traceur使用ES6 - learn es6</title><meta name="description" content=""><meta name="author" content=""><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1"><link rel="stylesheet" href="../assets/css/bulma.min.css"><link rel="stylesheet" href="../assets/css/app.css"><!--[if lt IE 9]>
<script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]--><link rel="shortcut icon" href=""></head><body dir="ltr"><nav class="columns navbar"><div class="column logo is-3 is-offset-1"><a class="is-brand" href="../index.html">learn es6</a></div></nav><div class="columns content"><div class="column is-2-desktop is-3-widescreen is-hidden-touch"></div><div class="column article-container is-11-tablet is-8-desktop is-6-widescreen"><div class="breadcrumb-area"><a href="../index.html" class="breadcrumb-item">Home</a><span class="breadcrumb-delimiter"> &gt; </span><a href="../chapters01/index.html" class="breadcrumb-item">第一章 ECMAScript 6 简介</a><span class="breadcrumb-delimiter"> &gt; </span><a href="../chapters01/Traceur.html" class="breadcrumb-item">通过Traceur使用ES6</a></div><h1 class="article-title">通过Traceur使用ES6</h1><div class="article"><p><code>Google</code>公司的<code>Traceur</code>编译器 ，可以将<code>ES6</code>代码编译为<code>ES5</code>代码，<code>https//github.com/google/traceur-compiler</code>。</p><h2 id="node-环境的用法">Node 环境的用法 <a class="markdownIt-Anchor" href="#node-环境的用法">#</a></h2><p><code>Traceur</code> 的 <code>Node</code> 用法如下（假定已安装<code>traceur</code>模块）。</p><pre class="hljs"><code><span class="hljs-keyword">var</span> traceur = <span class="hljs-built_in">require</span>(<span class="hljs-string">'traceur'</span>);
<span class="hljs-keyword">var</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">'fs'</span>);

<span class="hljs-comment">// 将 ES6 脚本转为字符串</span>
<span class="hljs-keyword">var</span> contents = fs.readFileSync(<span class="hljs-string">'es6-file.js'</span>).toString();

<span class="hljs-keyword">var</span> result = traceur.compile(contents, {
  <span class="hljs-attr">filename</span>: <span class="hljs-string">'es6-file.js'</span>,
  <span class="hljs-attr">sourceMap</span>: <span class="hljs-literal">true</span>,
  <span class="hljs-comment">// 其他设置</span>
  modules: <span class="hljs-string">'commonjs'</span>
});

<span class="hljs-keyword">if</span> (result.error)
  <span class="hljs-keyword">throw</span> result.error;

<span class="hljs-comment">// result 对象的 js 属性就是转换后的 ES5 代码</span>
fs.writeFileSync(<span class="hljs-string">'out.js'</span>, result.js);
<span class="hljs-comment">// sourceMap 属性对应 map 文件</span>
fs.writeFileSync(<span class="hljs-string">'out.js.map'</span>, result.sourceMap);
</code></pre><hr><h2 id="命令行转换">命令行转换 <a class="markdownIt-Anchor" href="#命令行转换">#</a></h2><p>作为命令行工具使用时，<code>Traceur</code> 是一个 <code>Node</code> 的模块，首先需要用 <code>npm</code> 安装。</p><pre class="hljs"><code>$ npm install -g traceur
</code></pre><p>安装成功后，就可以在命令行下使用 <code>Traceur</code> 了。</p><p><code>Traceur</code> 直接运行 <code>ES6</code> 脚本文件，会在标准输出显示运行结果，以前面的<code>calc.js</code>为例。</p><pre class="hljs"><code>$ traceur calc.js
Calc constructor
9
</code></pre><p>如果要将 <code>ES6</code> 脚本转为 <code>ES5</code> 保存，要采用下面的写法。</p><pre class="hljs"><code>$ traceur --script calc.es6.js --out calc.es5.js
</code></pre><p>上面代码的<code>--script</code>选项表示指定输入文件，<code>--out</code>选项表示指定输出文件。</p><p>为了防止有些特性编译不成功，最好加上<code>--experimental</code>选项。</p><pre class="hljs"><code>$ traceur --script calc.es6.js --out calc.es5.js --experimental
</code></pre><p>命令行下转换生成的文件，就可以直接放到浏览器中运行。</p><hr><h2 id="浏览器环境">浏览器环境 <a class="markdownIt-Anchor" href="#浏览器环境">#</a></h2><p><code>Traceur</code> 允许将 <code>ES6</code> 代码直接插入网页。首先，必须在网页头部加载 <code>Traceur</code> 库文件。</p><pre class="hljs"><code>&lt;script src=<span class="hljs-string">"https://google.github.io/traceur-compiler/bin/traceur.js"</span>&gt;<span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
&lt;script src=<span class="hljs-string">"https://google.github.io/traceur-compiler/bin/BrowserSystem.js"</span>&gt;<span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
&lt;script src=<span class="hljs-string">"https://google.github.io/traceur-compiler/src/bootstrap.js"</span>&gt;<span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
&lt;script type=<span class="hljs-string">"module"</span>&gt;
  <span class="hljs-keyword">import</span> <span class="hljs-string">'./Greeter.js'</span>;
<span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre><p>上面代码中，一共有 <code>4</code> 个<code>script</code>标签。第一个是加载 <code>Traceur</code> 的<code>库文件</code>，第二个和第三个是将这个库文件用于<code>浏览器环境</code>，第四个则是<code>加载用户脚本</code>，这个脚本里面可以使用 <code>ES6</code> 代码。</p><p>注意，第四个<code>script</code>标签的<code>type</code>属性的值是<code>module</code>，而不是<code>text/javascript</code>。这是 <code>Traceur</code> 编译器识别 <code>ES6</code> 代码的标志，编译器会自动将所有<code>type=module</code>的代码编译为 <code>ES5</code>，然后再交给浏览器执行。</p><p>除了引用外部 <code>ES6</code> 脚本，也可以直接在网页中放置 <code>ES6</code> 代码。</p><pre class="hljs"><code>&lt;script type=<span class="hljs-string">"module"</span>&gt;
  <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">Calc</span> </span>{
    <span class="hljs-keyword">constructor</span>() {
      <span class="hljs-built_in">console</span>.log(<span class="hljs-string">'Calc constructor'</span>);
    }
    add(a, b) {
      <span class="hljs-keyword">return</span> a + b;
    }
  }

  <span class="hljs-keyword">var</span> c = <span class="hljs-keyword">new</span> Calc();
  <span class="hljs-built_in">console</span>.log(c.add(<span class="hljs-number">4</span>,<span class="hljs-number">5</span>));
<span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre><p>正常情况下，上面代码会在控制台打印出<code>9</code>。</p><p>如果想对 <code>Traceur</code> 的行为有精确控制，可以采用下面参数配置的写法。</p><pre class="hljs"><code>&lt;script&gt;
  <span class="hljs-comment">// Create the System object</span>
  <span class="hljs-built_in">window</span>.System = <span class="hljs-keyword">new</span> traceur.runtime.BrowserTraceurLoader();
  <span class="hljs-comment">// Set some experimental options</span>
  <span class="hljs-keyword">var</span> metadata = {
    <span class="hljs-attr">traceurOptions</span>: {
      <span class="hljs-attr">experimental</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">properTailCalls</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">symbols</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">arrayComprehension</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">asyncFunctions</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">asyncGenerators</span>: exponentiation,
      <span class="hljs-attr">forOn</span>: <span class="hljs-literal">true</span>,
      <span class="hljs-attr">generatorComprehension</span>: <span class="hljs-literal">true</span>
    }
  };
  <span class="hljs-comment">// Load your module</span>
  System.import(<span class="hljs-string">'./myModule.js'</span>, {<span class="hljs-attr">metadata</span>: metadata}).catch(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params">ex</span>) </span>{
    <span class="hljs-built_in">console</span>.error(<span class="hljs-string">'Import failed'</span>, ex.stack || ex);
  });
<span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre><p>上面代码中，首先生成 <code>Traceur</code> 的全局对象<code>window.System</code>，然后<code>System.import</code>方法可以用来加载 <code>ES6</code>。加载的时候，需要传入一个配置对象<code>metadata</code>，该对象的<code>traceurOptions</code>属性可以配置支持 ES6 功能。如果设为<code>experimental: true</code>，就表示除了 <code>ES6</code> 以外，还支持一些实验性的新功能。</p><hr><h2 id="在线转换">在线转换 <a class="markdownIt-Anchor" href="#在线转换">#</a></h2><p><code>Traceur</code> 也提供一个<a href="http://google.github.io/traceur-compiler/demo/repl.html" target="_blank" rel="noopener">在线编译器</a>，可以在线将 <code>ES6</code> 代码转为 <code>ES5</code> 代码。转换后的代码，可以直接作为 <code>ES5</code> 代码插入网页运行。</p><figure><img src="https://user-images.githubusercontent.com/18508817/52532829-bac61000-2d65-11e9-90f4-83c0de61b2fa.png" alt="image"><figcaption>image</figcaption></figure><p>上面的例子转为 <code>ES5</code> 代码运行，就是下面这个样子。</p><pre class="hljs"><code>&lt;script src=<span class="hljs-string">"https://google.github.io/traceur-compiler/bin/traceur.js"</span>&gt;<span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
&lt;script src=<span class="hljs-string">"https://google.github.io/traceur-compiler/bin/BrowserSystem.js"</span>&gt;<span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
&lt;script src=<span class="hljs-string">"https://google.github.io/traceur-compiler/src/bootstrap.js"</span>&gt;<span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
&lt;script&gt;
$traceurRuntime.ModuleStore.getAnonymousModule(<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
<span class="hljs-meta">  "use strict"</span>;
  (<span class="hljs-function"><span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) </span>{
    <span class="hljs-keyword">var</span> $-<span class="hljs-number">-0</span>;
    <span class="hljs-keyword">var</span> a = [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">45</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>];
    ($-<span class="hljs-number">-0</span> = <span class="hljs-built_in">console</span>).log.apply($-<span class="hljs-number">-0</span>, $traceurRuntime.spread(a));
  });
  <span class="hljs-keyword">return</span> {};
});
<span class="xml"><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span></span>
</code></pre><hr></div><div dir="ltr" class="level article-bar is-mobile"><div class="level-item has-text-centered"><a title="previous page" class="previouse-article-link" href="../chapters01/Babel.html"><span class="icon icon-previous" data-icon="previous"></span><span class="link-content">&laquo; Previous</span></a></div><div class="level-item has-text-centered"><a title="font size" class="link-item link-item-size"><span class="icon icon-size" data-icon="size"></span></a></div><div class="level-item has-text-centered"><a title="table of content" class="link-item link-item-toc"><span class="icon icon-toc" data-icon="toc"></span></a></div><div class="level-item has-text-centered"><a title="top" href="#"><span class="icon icon-up" data-icon="up"></span> <span class="link-content">⤊ Top</span></a></div><div class="level-item has-text-centered"><a title="next page" class="next-article-link" href="../chapters01/base.html"><span class="icon icon-next" data-icon="next"></span><span class="link-content">Next &raquo;</span></a></div></div></div><div class="column is-2-widescreen is-hidden"></div></div><div class="columns foot"><div class="column is-3 is-offset-9 build-by">Build by <a href="https://github.com/ruanyf/loppo" target="_blank">Loppo</a> 0.6.14</div></div><div class="book-toc notification is-warning is-hidden"><h3>Table of chapters &nbsp;<span class="title-close"><a class="button is-danger"> Close</a></span></h3><ul class="chapter-area"><li class="chapter-item"><a href="../chapters01/index.html">第一章 ECMAScript 6 简介</a>&nbsp;<a class="first-level-collapse"><span class="icon icon-collapse" data-icon="collapse"></span></a></li><ul class="chapter-level-1 chapter-level-1-current"><li class="chapter-item"><a href="../chapters01/Babel.html">通过Babel使用ES6</a></li><li class="chapter-item chapter-item-current"><a href="../chapters01/Traceur.html">通过Traceur使用ES6</a></li><li class="chapter-item"><a href="../chapters01/base.html">基础前置知识</a></li></ul><li class="chapter-item"><a href="../chapters02/index.html">第二章 let和const命令</a>&nbsp;<a class="first-level-collapse"><span class="icon icon-expand" data-icon="expand"></span></a></li><ul class="chapter-level-1"><li class="chapter-item"><a href="../chapters02/base.html">前置知识了解</a></li><li class="chapter-item"><a href="../chapters02/const.html">const 命令</a></li><li class="chapter-item"><a href="../chapters02/let.html">let 命令</a></li></ul><li class="chapter-item"><a href="../chapters03/index.html">第三章 变量的解构赋值</a>&nbsp;<a class="first-level-collapse"><span class="icon icon-expand" data-icon="expand"></span></a></li><ul class="chapter-level-1"><li class="chapter-item"><a href="../chapters03/base.html">基础数据结构</a></li><li class="chapter-item"><a href="../chapters03/complex.html">复杂数据结构</a></li><li class="chapter-item"><a href="../chapters03/parentheses.html">圆括号问题</a></li><li class="chapter-item"><a href="../chapters03/use.html">用途</a></li></ul><li class="chapter-item"><a href="../chapters04/index.html">第四章 字符串的扩展</a>&nbsp;<a class="first-level-collapse"><span class="icon icon-expand" data-icon="expand"></span></a></li><ul class="chapter-level-1"><li class="chapter-item"><a href="../chapters04/instance-function-extend.html">实例对象方法扩展</a></li><li class="chapter-item"><a href="../chapters04/prototype-function-extend.html">原型对象方法扩展</a></li><li class="chapter-item"><a href="../chapters04/string-Iterator.html">字符串的遍历器接口</a></li><li class="chapter-item"><a href="../chapters04/tag-template.html">标签模板</a></li><li class="chapter-item"><a href="../chapters04/template-string.html">模板字符串</a></li><li class="chapter-item"><a href="../chapters04/unicode.html">字符的 Unicode 表示法</a></li></ul></ul></div><div class="progress-indicator"></div><!-- SCRIPTS --><script>var LOPPO={current_path:"chapters01/Traceur.md",relative_root_path:"../",article_toc:'<ul class="markdownIt-TOC">\n<li><a href="#node-%E7%8E%AF%E5%A2%83%E7%9A%84%E7%94%A8%E6%B3%95">Node 环境的用法</a></li>\n<li><a href="#%E5%91%BD%E4%BB%A4%E8%A1%8C%E8%BD%AC%E6%8D%A2">命令行转换</a></li>\n<li><a href="#%E6%B5%8F%E8%A7%88%E5%99%A8%E7%8E%AF%E5%A2%83">浏览器环境</a></li>\n<li><a href="#%E5%9C%A8%E7%BA%BF%E8%BD%AC%E6%8D%A2">在线转换</a></li>\n</ul>\n'}</script><script src="../assets/js/app.js"></script></body></html>