<!DOCTYPE html><html><head><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta charset="utf-8"><title>原型对象方法扩展 - learn es6</title><meta name="description" content=""><meta name="author" content=""><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1"><link rel="stylesheet" href="../assets/css/bulma.min.css"><link rel="stylesheet" href="../assets/css/app.css"><!--[if lt IE 9]>
<script src="//cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.2/html5shiv.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]--><link rel="shortcut icon" href=""></head><body dir="ltr"><nav class="columns navbar"><div class="column logo is-3 is-offset-1"><a class="is-brand" href="../index.html">learn es6</a></div></nav><div class="columns content"><div class="column is-2-desktop is-3-widescreen is-hidden-touch"></div><div class="column article-container is-11-tablet is-8-desktop is-6-widescreen"><div class="breadcrumb-area"><a href="../index.html" class="breadcrumb-item">Home</a><span class="breadcrumb-delimiter"> &gt; </span><a href="../chapters04/index.html" class="breadcrumb-item">第四章 字符串的扩展</a><span class="breadcrumb-delimiter"> &gt; </span><a href="../chapters04/prototype-function-extend.html" class="breadcrumb-item">原型对象方法扩展</a></div><h1 class="article-title">原型对象方法扩展</h1><div class="article"><h1 id="原型对象方法扩展">原型对象方法扩展 <a class="markdownIt-Anchor" href="#原型对象方法扩展">#</a></h1><h2 id="fromcodepoint">fromCodePoint() <a class="markdownIt-Anchor" href="#fromcodepoint">#</a></h2><p><code>ES5</code> 提供<code>String.fromCharCode</code>方法，用于从<code>码点</code>返回对应<code>字符</code>，但是这个方法不能识别 <code>32</code> 位的 <code>UTF-16</code> 字符（<code>Unicode</code> 编号大于<code>0xFFFF</code>）。</p><pre class="hljs"><code>(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">log, S</span>) </span>{
    log(S.fromCharCode(<span class="hljs-number">0x20BB7</span>)); <span class="hljs-comment">// ஷ</span>
})(<span class="hljs-built_in">console</span>.log, <span class="hljs-built_in">String</span>)
</code></pre><p>上面代码中，<code>String.fromCharCode</code>不能识别大于<code>0xFFFF</code>的码点，所以<code>0x20BB7</code>就发生了<code>溢出</code>，最高位<code>2</code>被舍弃了，最后返回码点<code>U+0BB7</code>对应的<code>字符</code>，而不是码点<code>U+20BB7</code>对应的<code>字符</code>。</p><p><code>ES6</code> 提供了<code>String.fromCodePoint</code>方法，可以识别大于<code>0xFFFF</code>的字符，弥补了<code>String.fromCharCode</code>方法的不足。在作用上，正好与<code>codePointAt</code>方法相反。</p><pre class="hljs"><code>(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">log, S</span>) </span>{
    log(S.fromCodePoint(<span class="hljs-number">0x20BB7</span>)); <span class="hljs-comment">// 𠮷</span>
    log(S.fromCodePoint(<span class="hljs-number">0x78</span>, <span class="hljs-number">0x1f680</span>, <span class="hljs-number">0x79</span>) === <span class="hljs-string">'x\uD83D\uDE80y'</span>); <span class="hljs-comment">// true</span>
})(<span class="hljs-built_in">console</span>.log, <span class="hljs-built_in">String</span>)
</code></pre><p>上面代码中，如果<code>String.fromCodePoint</code>方法有多个<code>参数</code>，则它们会被<code>合并</code>成一个<code>字符串</code>返回。</p><p>注意，<code>fromCodePoint</code>方法定义在<code>String</code>对象上，而<code>codePointAt</code>方法定义在字符串的<code>实例对象</code>上。</p><hr><h2 id="raw">raw() <a class="markdownIt-Anchor" href="#raw">#</a></h2><p><code>ES6</code> 还为原生的 <code>String</code> 对象，提供了一个<code>raw</code>方法。</p><p><code>String.raw</code>方法，往往用来充当<code>模板字符串</code>的<code>处理函数</code>，返回一个<code>斜杠</code>都被<code>转义</code>（即<code>斜杠</code>前面再加一个<code>斜杠</code>）的<code>字符串</code>，对应于<code>替换变量</code>后的<code>模板字符串</code>。</p><pre class="hljs"><code>(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">log, S</span>) </span>{
    log(S.raw<span class="hljs-string">`Hi\n<span class="hljs-subst">${<span class="hljs-number">2</span>+<span class="hljs-number">3</span>}</span>!`</span>);<span class="hljs-comment">//  'Hi\\n5!'</span>

    log(S.raw<span class="hljs-string">`Hi\u000A!`</span>);<span class="hljs-comment">//  'Hi\\u000A!'</span>
})(<span class="hljs-built_in">console</span>.log, <span class="hljs-built_in">String</span>)
</code></pre><p>如果<code>原字符串</code>的<code>斜杠</code>已经转义，那么<code>String.raw</code>会进行再次转义。</p><pre class="hljs"><code>(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">log, S</span>) </span>{
    log(S.raw<span class="hljs-string">`Hi\\n`</span>);<span class="hljs-comment">//  'Hi\\n'</span>
})(<span class="hljs-built_in">console</span>.log, <span class="hljs-built_in">String</span>)
</code></pre><p><code>String.raw</code>方法可以作为处理<code>模板字符串</code>的基本方法，它会将所有变量<code>替换</code>，而且对<code>斜杠</code>进行<code>转义</code>，方便下一步作为<code>字符串</code>来使用。</p><p><code>String.raw</code>方法也可以作为<code>正常</code>的<code>函数</code>使用。</p><p>这时，它的第一个参数，应该是一个具有<code>raw属性</code>的<code>对象</code>，且<code>raw属性</code>的值应该是一个<code>数组</code>。</p><pre class="hljs"><code>(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">log, S</span>) </span>{
    log(S.raw({
        <span class="hljs-attr">raw</span>: <span class="hljs-string">'test'</span>
    }, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>));
    <span class="hljs-comment">// 't0e1s2t'</span>

    <span class="hljs-comment">// 等同于</span>
    log(S.raw({
        <span class="hljs-attr">raw</span>: [<span class="hljs-string">'t'</span>, <span class="hljs-string">'e'</span>, <span class="hljs-string">'s'</span>, <span class="hljs-string">'t'</span>]
    }, <span class="hljs-number">0</span>, <span class="hljs-number">1</span>, <span class="hljs-number">2</span>));<span class="hljs-comment">// 't0e1s2t'</span>
})(<span class="hljs-built_in">console</span>.log, <span class="hljs-built_in">String</span>)
</code></pre><p>作为函数，<code>String.raw</code>的代码实现基本如下。</p><pre class="hljs"><code><span class="hljs-built_in">String</span>.raw = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">strings, ...values</span>) </span>{
  <span class="hljs-keyword">let</span> output = <span class="hljs-string">''</span>;
  <span class="hljs-keyword">let</span> index;
  <span class="hljs-keyword">for</span> (index = <span class="hljs-number">0</span>; index &lt; values.length; index++) {
    output += strings.raw[index] + values[index];
  }

  output += strings.raw[index]
  <span class="hljs-keyword">return</span> output;
}
</code></pre></div><div dir="ltr" class="level article-bar is-mobile"><div class="level-item has-text-centered"><a title="previous page" class="previouse-article-link" href="../chapters04/instance-function-extend.html"><span class="icon icon-previous" data-icon="previous"></span><span class="link-content">&laquo; Previous</span></a></div><div class="level-item has-text-centered"><a title="font size" class="link-item link-item-size"><span class="icon icon-size" data-icon="size"></span></a></div><div class="level-item has-text-centered"><a title="table of content" class="link-item link-item-toc"><span class="icon icon-toc" data-icon="toc"></span></a></div><div class="level-item has-text-centered"><a title="top" href="#"><span class="icon icon-up" data-icon="up"></span> <span class="link-content">⤊ Top</span></a></div><div class="level-item has-text-centered"><a title="next page" class="next-article-link" href="../chapters04/string-Iterator.html"><span class="icon icon-next" data-icon="next"></span><span class="link-content">Next &raquo;</span></a></div></div></div><div class="column is-2-widescreen is-hidden"></div></div><div class="columns foot"><div class="column is-3 is-offset-9 build-by">Build by <a href="https://github.com/ruanyf/loppo" target="_blank">Loppo</a> 0.6.14</div></div><div class="book-toc notification is-warning is-hidden"><h3>Table of chapters &nbsp;<span class="title-close"><a class="button is-danger"> Close</a></span></h3><ul class="chapter-area"><li class="chapter-item"><a href="../chapters01/index.html">第一章 ECMAScript 6 简介</a>&nbsp;<a class="first-level-collapse"><span class="icon icon-expand" data-icon="expand"></span></a></li><ul class="chapter-level-1"><li class="chapter-item"><a href="../chapters01/Babel.html">通过Babel使用ES6</a></li><li class="chapter-item"><a href="../chapters01/Traceur.html">通过Traceur使用ES6</a></li><li class="chapter-item"><a href="../chapters01/base.html">基础前置知识</a></li></ul><li class="chapter-item"><a href="../chapters02/index.html">第二章 let和const命令</a>&nbsp;<a class="first-level-collapse"><span class="icon icon-expand" data-icon="expand"></span></a></li><ul class="chapter-level-1"><li class="chapter-item"><a href="../chapters02/base.html">前置知识了解</a></li><li class="chapter-item"><a href="../chapters02/const.html">const 命令</a></li><li class="chapter-item"><a href="../chapters02/let.html">let 命令</a></li></ul><li class="chapter-item"><a href="../chapters03/index.html">第三章 变量的解构赋值</a>&nbsp;<a class="first-level-collapse"><span class="icon icon-expand" data-icon="expand"></span></a></li><ul class="chapter-level-1"><li class="chapter-item"><a href="../chapters03/base.html">基础数据结构</a></li><li class="chapter-item"><a href="../chapters03/complex.html">复杂数据结构</a></li><li class="chapter-item"><a href="../chapters03/parentheses.html">圆括号问题</a></li><li class="chapter-item"><a href="../chapters03/use.html">用途</a></li></ul><li class="chapter-item"><a href="../chapters04/index.html">第四章 字符串的扩展</a>&nbsp;<a class="first-level-collapse"><span class="icon icon-collapse" data-icon="collapse"></span></a></li><ul class="chapter-level-1 chapter-level-1-current"><li class="chapter-item"><a href="../chapters04/instance-function-extend.html">实例对象方法扩展</a></li><li class="chapter-item chapter-item-current"><a href="../chapters04/prototype-function-extend.html">原型对象方法扩展</a></li><li class="chapter-item"><a href="../chapters04/string-Iterator.html">字符串的遍历器接口</a></li><li class="chapter-item"><a href="../chapters04/tag-template.html">标签模板</a></li><li class="chapter-item"><a href="../chapters04/template-string.html">模板字符串</a></li><li class="chapter-item"><a href="../chapters04/unicode.html">字符的 Unicode 表示法</a></li></ul></ul></div><div class="progress-indicator"></div><!-- SCRIPTS --><script>var LOPPO={current_path:"chapters04/prototype-function-extend.md",relative_root_path:"../",article_toc:'<ul class="markdownIt-TOC">\n<li><a href="#fromcodepoint">fromCodePoint()</a></li>\n<li><a href="#raw">raw()</a></li>\n</ul>\n'}</script><script src="../assets/js/app.js"></script></body></html>